<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard with Sidebar</title>
    <link rel="stylesheet" href="/admin/styles.css" />
    <link rel="icon" href="images/LogoHsnStudio.png" type="image/x-icon">
    <link rel="stylesheet" href="/none.js">
<script>
  function removeHtmlFromUrl() {
    if (window.location.href.endsWith('.html')) {
      const newUrl = window.location.href.replace('.html', '');
      history.replaceState(null, '', newUrl);
    }
  }
  
removeHtmlFromUrl(); 
  
</script>

    <!-- Link ke file CSS -->
    <style>
      /* Modal Styling */
      .modal {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        background-color: rgba(0, 0, 0, 0.4); /* Black with opacity */
        overflow: auto; /* Enable scroll if needed */
      }

      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 400px;
        text-align: center;
      }

      .modal button {
        padding: 10px 20px;
        margin: 10px;
        cursor: pointer;
      }

      .cancel {
        background-color: #f44336;
        color: white;
      }

      .confirm {
        background-color: #ff0000;
        color: white;
      }

      /* Notifikasi */
      .toast {
        visibility: hidden;
        min-width: 250px;
        margin-left: -125px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 2px;
        padding: 16px;
        position: fixed;
        z-index: 1;
        left: 50%;
        bottom: 30px;
        font-size: 17px;
      }

      .toast.show {
        visibility: visible;
        animation: fadeInOut 3s;
      }

      @keyframes fadeInOut {
        0% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }

      .settings-section {
        margin-bottom: 30px;
      }

      .settings-section h3 {
        font-size: 20px;
        margin-bottom: 10px;
      }

      .settings-section p,
      .settings-section ul {
        font-size: 16px;
        margin-left: 20px;
      }

      .settings-section a {
        color: #007bff;
        text-decoration: none;
      }

      .settings-section a:hover {
        text-decoration: underline;
      }

      .settings-section ul {
        list-style-type: disc;
        margin-left: 40px;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <!-- Sidebar -->
      <nav class="sidebar">
        <div class="sidebar-header">
          <h2>Admin Galery</h2>
        </div>
        <ul class="sidebar-menu">
          <li>
            <a href="#" class="sidebar-link active" data-target="inputData"
              >Masukkan Data</a
            >
          </li>
          <li>
            <a href="#" class="sidebar-link" data-target="viewData"
              >Lihat Data</a
            >
          </li>

          <li>
            <a href="/admin/detailtrans.html" class="sidebar-link" data-target="trans">Transaksi</a>
          </li>

          <li>
            <a href="/index.html" class="sidebar-link" data-target="trans">Web</a>
          </li>
        </ul>
      </nav>

      <!-- Main Content -->
      <div class="main-content">
        <header>
          <h1>Dashboard - Galery</h1>
        </header>

        <div id="page-content">
          <!-- Masukkan Data Form -->
          <div id="inputData" class="content" style="display: block">
            <h1>Masukkan Judul dan Link</h1>
            <form id="dataForm">
              <label for="title">Judul: </label>
              <input type="text" id="title" required /><br /><br />
              <label for="link">Link Google Drive: </label>
              <input type="url" id="link" required /><br /><br />
              <button type="submit">Kirim Data</button>
            </form>
          </div>

          <!-- Lihat Data Table -->
          <div id="viewData" class="content" style="display: none">
            <h2>Data yang Tersimpan</h2>
            <table border="1">
              <thead>
                <tr>
                  <th>Judul</th>
                  <th>Link</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>

          <!-- Detail Informasi -->
          <div id="settings" class="content" style="display: none">
            <h2>Detail Informasi</h2>

            <!-- Informasi Umum -->
            <div class="settings-section">
              <h3>Informasi Umum</h3>
              <p><strong>Nama Situs:</strong> Admin Panel</p>
              <p>
                <strong>Deskripsi:</strong> Panel admin ini digunakan untuk
                mengelola dan mengatur data secara efisien.
              </p>
              <p><strong>Email Kontak:</strong> layananhsnstudio@gmail.com</p>
              <p><strong>Versi Sistem:</strong> v1.0.0</p>
            </div>

            <!-- Statistik Penggunaan -->
            <div class="settings-section">
              <h3>Statistik Penggunaan</h3>
              <p><strong>Total Pengguna:</strong> 150</p>
              <p>
                <strong>Total Data Tersimpan:</strong>
                <span id="totalDataCount">---</span>
              </p>
              <!-- Data Tersimpan -->
              <p><strong>Terakhir Diperbarui:</strong> 26 Maret 2025</p>
            </div>

            <!-- Informasi Pengembang -->
            <div class="settings-section">
              <h3>Informasi Pengembang</h3>
              <p><strong>Nama Pengembang:</strong> Husain Mulyansyah</p>
              <p>
                <strong>Email Pengembang:</strong> husainmulyansyah28@gamil.com
              </p>
              <p>
                <strong>Website Pengembang:</strong>
                <a href="https://Husain Mulyansyah" target="_blank"
                  >Husain Mulyansyah</a
                >
              </p>
            </div>

            <!-- Riwayat Pembaruan -->
            <div class="settings-section">
              <h3>Riwayat Pembaruan</h3>
              <ul>
                <li>
                  <strong>v1.0.0:</strong> Rilis pertama dari panel admin.
                </li>
                <li>
                  <strong>v1.1.0:</strong> Penambahan fitur statistik pengguna
                  dan data.
                </li>
                <li>
                  <strong>v1.2.0:</strong> Pembaruan desain dan perbaikan bug.
                </li>
              </ul>
            </div>

            <!-- Informasi Keamanan -->
            <div class="settings-section">
              <h3>Informasi Keamanan</h3>
              <p>
                <strong>Enkripsi Data:</strong> Semua data yang disimpan
                dienkripsi dengan protokol AES-256.
              </p>
              <p>
                <strong>Proteksi Login:</strong> Verifikasi dua langkah
                diaktifkan untuk meningkatkan keamanan akun.
              </p>
            </div>
          </div>

          <!-- Logout -->
          <div id="logout" class="content" style="display: none">
            <h2>Detail Informasi</h2>
            <p>Pembuat Husain Mulyansyah</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Notifikasi -->
    <div id="toast" class="toast"></div>

    <!-- Modal Konfirmasi Hapus -->
    <div id="confirmModal" class="modal">
      <div class="modal-content">
        <p>Apakah Anda yakin ingin menghapus data ini?</p>
        <button id="cancelDelete" class="cancel">Batal</button>
        <button id="confirmDelete" class="confirm">Hapus</button>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        push,
        remove,
        get,
      } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCCRYX_sccuZyS6U219jupC3iXuU81SvIk",
        authDomain: "hsnimageview.firebaseapp.com",
        databaseURL: "https://hsnimageview-default-rtdb.firebaseio.com/",
        projectId: "hsnimageview",
        storageBucket: "hsnimageview.appspot.com",
        messagingSenderId: "815454639020",
        appId: "1:815454639020:web:b29867dccb7d9c10676009",
        measurementId: "G-PK7Y8R7TWJ",
      };

      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const form = document.getElementById("dataForm");
      const tableBody = document.getElementById("tableBody");
      const toast = document.getElementById("toast");

      let deleteId = null; // Track the ID of the data to delete

      // Function to generate the Google Drive embed link
      function generateDriveEmbedLink(url) {
        const regex = /\/folders\/([a-zA-Z0-9_-]+)/;
        const match = url.match(regex);
        if (match && match[1]) {
          return `https://drive.google.com/embeddedfolderview?id=${match[1]}#grid`;
        }
        return url;
      }

      // Show modal for confirmation
      function showConfirmModal(id) {
        deleteId = id;
        const modal = document.getElementById("confirmModal");
        modal.style.display = "block";
      }

      // Confirm delete
      document.getElementById("confirmDelete").addEventListener("click", () => {
        if (deleteId) {
          const dataRef = ref(database, "links/" + deleteId); // Get reference to the specific data
          remove(dataRef)
            .then(() => {
              showToast("Data berhasil dihapus!"); // Show success toast
              loadData(); // Reload the data
              const modal = document.getElementById("confirmModal");
              modal.style.display = "none"; // Hide the confirmation modal
            })
            .catch((error) => {
              showToast("Gagal menghapus data: " + error.message); // Show error toast
              const modal = document.getElementById("confirmModal");
              modal.style.display = "none"; // Hide the confirmation modal
            });
        }
      });

      // Cancel delete action
      document.getElementById("cancelDelete").addEventListener("click", () => {
        const modal = document.getElementById("confirmModal");
        modal.style.display = "none"; // Close the confirmation modal
      });

      // Load data from Firebase
      function loadData() {
        get(ref(database, "links")).then((snapshot) => {
          tableBody.innerHTML = ""; // Clear the current table data
          if (snapshot.exists()) {
            const data = snapshot.val(); // Get the data from Firebase
            Object.keys(data).forEach((id) => {
              const { title, link } = data[id]; // Extract title and link
              const embedLink = generateDriveEmbedLink(link); // Convert link if necessary

              // Create a new table row for each data entry
              const row = document.createElement("tr");
              row.id = id; // Set the ID of the row to match the Firebase ID
              row.innerHTML = `
                            <td>${title}</td>
                            <td><a href="${embedLink}" target="_blank">${link}</a></td>
                            <td><button onclick="showConfirmModal('${id}')">Hapus</button></td>
                        `;
              tableBody.appendChild(row); // Add the row to the table
            });
          }
        });
      }

      // Submit form and add data to Firebase
      form.addEventListener("submit", function (event) {
        event.preventDefault();
        const title = document.getElementById("title").value;
        const link = document.getElementById("link").value;

        // Generate the embedded Google Drive link
        const embedLink = generateDriveEmbedLink(link);
        showToast("Data berhasil disimpan!");

        // Push data to Firebase
        push(ref(database, "links"), { title, link: embedLink }).then(() => {
          form.reset(); // Reset the form after submitting
          loadData(); // Reload the data
        });
      });

      // Fungsi untuk menampilkan notifikasi
      function showToast(message) {
        toast.textContent = message; // Menampilkan pesan
        toast.classList.add("show"); // Menambahkan kelas "show" agar notifikasi muncul
        setTimeout(() => {
          toast.classList.remove("show"); // Menghilangkan notifikasi setelah 3 detik
        }, 3000);
      }

      // Menangani navigasi antar menu pada sidebar
      const navLinks = document.querySelectorAll(".sidebar-link");
      const contentSections = document.querySelectorAll(".content");

      // Menambahkan event listener untuk setiap link di sidebar
      navLinks.forEach((link) => {
        link.addEventListener("click", (event) => {
          // Menghapus kelas 'active' dari semua link dan konten
          navLinks.forEach((link) => link.classList.remove("active"));
          contentSections.forEach(
            (section) => (section.style.display = "none")
          );

          // Menambahkan kelas 'active' pada link yang dipilih
          link.classList.add("active");

          // Menampilkan konten sesuai dengan data-target
          const target = event.target.getAttribute("data-target");
          document.getElementById(target).style.display = "block";
        });
      });

      // Mendapatkan elemen untuk menampilkan jumlah data
      const totalDataCountElement = document.getElementById("totalDataCount");

      // Fungsi untuk mendapatkan jumlah data dari Firebase
      function loadDataCount() {
        const linksRef = ref(database, "links");
        get(linksRef)
          .then((snapshot) => {
            if (snapshot.exists()) {
              // Menghitung jumlah data yang ada
              const data = snapshot.val();
              const totalData = Object.keys(data).length; // Menghitung jumlah entri
              totalDataCountElement.textContent = totalData; // Menampilkan jumlah data
            } else {
              totalDataCountElement.textContent = "0"; // Jika tidak ada data
            }
          })
          .catch((error) => {
            console.error("Gagal mengambil data:", error);
            totalDataCountElement.textContent = "Terjadi kesalahan";
          });
      }

      window.onload = function () {
        loadDataCount();
        loadData();
      };

      window.showConfirmModal = showConfirmModal;
    </script>
  </body>
</html>
